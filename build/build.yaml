steps:
  # Build container image.
- id: Build container image
  name: "gcr.io/agmsb-k8s/gcloud"
  entrypoint: "bash"
  args:
    - '-c'
    - |
      gcloud alpha builds submit --pack image=gcr.io/$PROJECT_ID/next-2021-app:$COMMIT_SHA
# Open pull request against env repo. 
- id: Create GitHub pull request
  name: 'launcher.gcr.io/google/ubuntu1604'
  entrypoint: bash
  args:
    - '-c'
    - |
      curl -X POST -u agmsb:${GH_TOKEN} -d '{"head":"development","base":"main", "title":"PR from development"}' https://api.github.com/repos/agmsb/next-2021/pulls
  secretEnv: ['GH_TOKEN']
availableSecrets:
  secretManager:
  - versionName: projects/agmsb-k8s/secrets/github-token/versions/latest
    env: GH_TOKEN
# Run on a private pool.
options:
  workerPool: 'projects/agmsb-k8s/locations/us-west1/workerPools/sandbox-privatepool'